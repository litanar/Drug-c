<!DOCTYPE html>
<html lang="fa">
<head>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> MedMate </title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MZ67EPKD6Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-MZ67EPKD6Q');
</script>
    <!-- اضافه کردن فونت BYekan -->
    <link href="https://cdn.fontcdn.ir/Font/Persian/Yekan/Yekan.css" rel="stylesheet">
    <!-- اضافه کردن آیکون‌ها -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- اضافه کردن manifest.json -->
    <link rel="manifest" href="/manifest.json">
    <style>
        /* تنظیمات کلی */
        body {
            font-family: 'Yekan', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            text-align: right;
            background-color: #1a1a1a; /* پس‌زمینه تیره */
            margin: 0;
            padding: 0;
            color: #fff; /* متن سفید */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .light-theme {
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            background-color: #2c3e50; /* پس‌زمینه خاکستری تیره */
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .light-theme .container {
            background-color: #fff;
            color: #333;
        }
        h2 {
            color: inherit;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: inherit;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #444;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
            transition: border-color 0.3s ease, background-color 0.3s ease, color 0.3s ease;
            background-color: #34495e; /* پس‌زمینه خاکستری روشن */
            color: #fff; /* متن سفید */
        }
        .light-theme input, .light-theme select {
            background-color: #eee;
            color: #333;
        }
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #34495e; /* پس‌زمینه خاکستری روشن */
            border-radius: 5px;
            font-size: 16px;
            color: #fff; /* متن سفید */
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .light-theme .result {
            background-color: #eee;
            color: #333;
        }
        .result.show {
            opacity: 1;
        }
        .hidden {
            display: none !important; /* اطمینان از مخفی شدن */
        }
        .accordion {
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            width: 100%;
            text-align: right;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 10px; /* فاصله بین کشوها */
        }
        .accordion:hover {
            opacity: 0.9;
        }
        .accordion-content {
            padding: 10px;
            display: none;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .accordion-content.show {
            display: block;
        }
        /* رنگ‌های متفاوت برای کشوها */
        #drugCalculationBtn {
            background-color: #3498db; /* آبی */
        }
        #fluidCalculationBtn {
            background-color: #e67e22; /* نارنجی */
        }
        #microsetCalculationBtn {
            background-color: #9b59b6; /* بنفش */
        }
        #pediatricDrugCalculationBtn {
            background-color: #2ecc71; /* سبز */
        }
        #percentageDrugCalculationBtn {
            background-color: #e74c3c; /* قرمز */
        }
        #mEqToMgBtn {
            background-color: #4a5568; /* خاکستری تیره (سرمه‌ای) */
        }
        footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #888;
        }
        .light-theme footer {
            color: #666;
        }
        /* دکمه تغییر تم */
        #themeToggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        #themeToggle:hover {
            transform: scale(1.1);
        }
        /* دکمه نصب در سمت راست پایین */
        #addToHomeScreen {
            position: fixed;
            bottom: 20px;
            right: 20px; /* تغییر به سمت راست */
            width: 50px;
            height: 50px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        #addToHomeScreen:hover {
            transform: scale(1.1); /* تغییر اندازه هنگام هاور */
        }
        /* استایل بخش اشتراک‌گذاری */
        .share-icons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .share-icons a {
            text-decoration: none;
            color: white;
            font-size: 24px;
            transition: transform 0.2s ease;
        }
        .share-icons a:hover {
            transform: scale(1.2);
        }
        .share-icons .whatsapp {
            color: #25d366; /* رنگ واتس‌آپ */
        }
        .share-icons .instagram {
            color: #e4405f; /* رنگ اینستاگرام */
        }
        .share-icons .telegram {
            color: #0088cc; /* رنگ تلگرام */
        }
        .share-icons .twitter {
            color: #1da1f2; /* رنگ توییتر */
        }
        .share-icons .sms {
            color: #34b7f1; /* رنگ SMS */
        }
        /* استایل بخش پرستار پلاس */
        .nurse-plus-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background-color: #34495e;
            border-radius: 10px;
        }
        .nurse-plus-section p {
            font-size: 14px; /* کوچک‌تر کردن فونت */
            margin-bottom: 15px;
            color: #fff;
        }
        .nurse-plus-section a {
            text-decoration: none;
            color: white;
        }
        .nurse-plus-section button {
            background-color: #2ecc71; /* سبز */
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .nurse-plus-section button:hover {
            background-color: #27ae60; /* سبز تیره */
        }
        /* استایل دکمه ارتباط با ما */
        .contact-button {
            margin-top: 20px;
            text-align: center;
        }
        .contact-button a {
            text-decoration: none;
            color: white;
            font-size: 14px; /* کاهش سایز فونت */
            background-color: #e67e22; /* نارنجی */
            padding: 8px 16px; /* کاهش پدینگ */
            border-radius: 5px;
            transition: background-color 0.3s ease;
            display: inline-flex; /* برای قرار دادن آیکون و متن در یک خط */
            align-items: center; /* وسط‌چین عمودی */
            justify-content: center; /* وسط‌چین افقی */
            width: 140px; /* عرض باکس */
            height: 40px; /* ارتفاع باکس */
        }
        .contact-button a:hover {
            background-color: #d35400; /* نارنجی تیره */
        }
        .contact-button a i {
            font-size: 16px; /* اندازه آیکون */
            margin-right: 8px; /* فاصله بین آیکون و متن */
        }
        /* استایل زیرنویس ساعت و تاریخ */
        .footer-info {
            text-align: center;
            margin-top: 10px;
            font-size: 12px; /* فونت ریز */
            color: #888;
        }
        .light-theme .footer-info {
            color: #666;
        }
        /* استایل رادیو باتن‌ها */
        .radio-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background-color: #34495e; /* پس‌زمینه خاکستری روشن */
            padding: 10px;
            border-radius: 5px;
        }
        .radio-group label {
            font-size: 12px; /* فونت کوچک‌تر */
            display: flex;
            align-items: center;
            color: #fff; /* متن سفید */
        }
        .radio-group input[type="radio"] {
            margin-left: 5px;
        }
        .radio-group-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff; /* متن سفید */
        }
    </style>
</head>
<body>
    <!-- دکمه تغییر تم -->
    <button id="themeToggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
    <!-- دکمه نصب در سمت راست پایین -->
    <button id="addToHomeScreen" onclick="addToHomeScreen()">
        <i class="fas fa-download"></i>
    </button>
    <div class="container">
        <!-- کشوی محاسبات دارویی -->
        <button class="accordion" id="drugCalculationBtn" onclick="toggleAccordion('drugCalculation')">محاسبات دارویی (پمپ و میکروست)</button>
        <div class="accordion-content" id="drugCalculation">
            <!-- دوز دارو -->
            <label for="drugDose">دوز دارو:</label>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="drugDose" placeholder="دوز دارو را وارد کنید">
                <select id="drugDoseUnit">
                    <option value="mg">mg</option>
                    <option value="mcg">mcg</option>
                    <option value="U">U</option>
                </select>
            </div>
            <!-- حجم سرنگ یا میکروست -->
            <label for="syringeVolume">حجم سرنگ یا میکروست (سی‌سی):</label>
            <input type="number" id="syringeVolume" placeholder="حجم سرنگ یا میکروست را وارد کنید">
            <!-- دوز تجویزی -->
            <label for="prescribedDose">دوز تجویزی:</label>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="prescribedDose" placeholder="دوز تجویزی را وارد کنید">
                <select id="prescribedDoseUnit" onchange="toggleWeightInput()">
                    <option value="mg/h">mg/h</option>
                    <option value="mg/min">mg/min</option> <!-- واحد جدید اضافه شد -->
                    <option value="mcg/kg/min">mcg/kg/min</option>
                    <option value="mcg/min">mcg/min</option>
                    <option value="mcg/h">mcg/h</option>
                    <option value="U/h">U/h</option>
                </select>
            </div>
            <!-- وزن (فقط برای دوزهای وابسته به وزن) -->
            <div id="weightInput" class="hidden">
                <label for="weight">وزن بیمار (کیلوگرم):</label>
                <input type="number" id="weight" placeholder="وزن بیمار را وارد کنید">
            </div>
            <!-- روش تزریق -->
            <div class="radio-group">
                <div class="radio-group-title">روش تزریق:</div>
                <label>
                    <input type="radio" name="infusionMethod" value="pump" checked> پمپ (cc/h)
                </label>
                <label>
                    <input type="radio" name="infusionMethod" value="microset"> میکروست (60 gtt/min)
                </label>
            </div>
            <button onclick="calculateDrug()">محاسبه دارو</button>
            <div class="result" id="drugResult"></div>
            <!-- بخش اشتراک‌گذاری -->
            <div class="share-icons hidden" id="drugShareIcons">
                <a href="#" class="whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="instagram" onclick="shareOnInstagram()"><i class="fab fa-instagram"></i></a>
                <a href="#" class="telegram" onclick="shareOnTelegram()"><i class="fab fa-telegram"></i></a>
                <a href="#" class="twitter" onclick="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="sms" onclick="shareViaSMS()"><i class="fas fa-sms"></i></a>
            </div>
        </div>
        <!-- کشوی محاسبات داروهای درصدی -->
        <button class="accordion" id="percentageDrugCalculationBtn" onclick="toggleAccordion('percentageDrugCalculation')">محاسبات داروهای درصدی</button>
        <div class="accordion-content" id="percentageDrugCalculation">
            <!-- درصد دارو -->
            <label for="drugPercentage">درصد دارو:</label>
            <input type="number" id="drugPercentage" placeholder="درصد دارو را وارد کنید (مثال: 1 برای ۱٪)">
            <!-- دوز مورد نیاز -->
            <label for="requiredDose">دوز مورد نیاز (میلی‌گرم):</label>
            <input type="number" id="requiredDose" placeholder="دوز مورد نیاز را وارد کنید">
            <button onclick="calculatePercentageDrug()">محاسبه سی‌سی مورد نیاز</button>
            <div class="result" id="percentageDrugResult"></div>
            <!-- بخش اشتراک‌گذاری -->
            <div class="share-icons hidden" id="percentageDrugShareIcons">
                <a href="#" class="whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="instagram" onclick="shareOnInstagram()"><i class="fab fa-instagram"></i></a>
                <a href="#" class="telegram" onclick="shareOnTelegram()"><i class="fab fa-telegram"></i></a>
                <a href="#" class="twitter" onclick="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="sms" onclick="shareViaSMS()"><i class="fas fa-sms"></i></a>
            </div>
        </div>
        <!-- کشوی محاسبات سرم -->
        <button class="accordion" id="fluidCalculationBtn" onclick="toggleAccordion('fluidCalculation')">محاسبات سرم</button>
        <div class="accordion-content" id="fluidCalculation">
            <!-- حجم سرم -->
            <label for="fluidVolume">حجم سرم (میلی‌لیتر):</label>
            <input type="number" id="fluidVolume" placeholder="حجم سرم را وارد کنید">
            <!-- زمان تزریق -->
            <label for="infusionTime">زمان تزریق (ساعت):</label>
            <input type="number" id="infusionTime" placeholder="زمان تزریق را وارد کنید">
            <!-- نوع ست سرم -->
            <label for="dripSet">نوع ست سرم:</label>
            <select id="dripSet">
                <option value="15">۱۵ قطره بر میلی‌لیتر</option>
                <option value="20">۲۰ قطره بر میلی‌لیتر</option>
            </select>
            <button onclick="calculateFluid()">محاسبه سرم</button>
            <div class="result" id="fluidResult"></div>
            <!-- بخش اشتراک‌گذاری -->
            <div class="share-icons hidden" id="fluidShareIcons">
                <a href="#" class="whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="instagram" onclick="shareOnInstagram()"><i class="fab fa-instagram"></i></a>
                <a href="#" class="telegram" onclick="shareOnTelegram()"><i class="fab fa-telegram"></i></a>
                <a href="#" class="twitter" onclick="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="sms" onclick="shareViaSMS()"><i class="fas fa-sms"></i></a>
            </div>
        </div>
        <!-- کشوی محاسبات میکروست -->
        <button class="accordion" id="microsetCalculationBtn" onclick="toggleAccordion('microsetCalculation')">محاسبات میکروست</button>
        <div class="accordion-content" id="microsetCalculation">
            <!-- حجم میکروست -->
            <label for="microsetVolume">حجم میکروست (میلی‌لیتر):</label>
            <input type="number" id="microsetVolume" placeholder="حجم میکروست را وارد کنید">
            <!-- زمان تزریق -->
            <label for="microsetInfusionTime">زمان تزریق (ساعت):</label>
            <input type="number" id="microsetInfusionTime" placeholder="زمان تزریق را وارد کنید">
            <button onclick="calculateMicroset()">محاسبه میکروست</button>
            <div class="result" id="microsetResult"></div>
            <!-- بخش اشتراک‌گذاری -->
            <div class="share-icons hidden" id="microsetShareIcons">
                <a href="#" class="whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="instagram" onclick="shareOnInstagram()"><i class="fab fa-instagram"></i></a>
                <a href="#" class="telegram" onclick="shareOnTelegram()"><i class="fab fa-telegram"></i></a>
                <a href="#" class="twitter" onclick="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="sms" onclick="shareViaSMS()"><i class="fas fa-sms"></i></a>
            </div>
        </div>
        <!-- کشوی محاسبات دارویی اطفال -->
        <button class="accordion" id="pediatricDrugCalculationBtn" onclick="toggleAccordion('pediatricDrugCalculation')">محاسبات دارویی اطفال</button>
        <div class="accordion-content" id="pediatricDrugCalculation">
            <!-- حجم بر حسب سی‌سی -->
            <label for="volumeCC">حجم بر حسب سی‌سی:</label>
            <input type="number" id="volumeCC" placeholder="حجم را وارد کنید (مثال: 0.175)">
            <button onclick="calculatePediatricDrug()">محاسبه واحدهای انسولین</button>
            <div class="result" id="pediatricDrugResult"></div>
            <!-- بخش اشتراک‌گذاری -->
            <div class="share-icons hidden" id="pediatricShareIcons">
                <a href="#" class="whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="instagram" onclick="shareOnInstagram()"><i class="fab fa-instagram"></i></a>
                <a href="#" class="telegram" onclick="shareOnTelegram()"><i class="fab fa-telegram"></i></a>
                <a href="#" class="twitter" onclick="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="sms" onclick="shareViaSMS()"><i class="fas fa-sms"></i></a>
            </div>
        </div>
        <!-- کشوی تبدیل میلی‌اکی‌والان به میلی‌گرم -->
        <button class="accordion" id="mEqToMgBtn" onclick="toggleAccordion('mEqToMg')">تبدیل میلی‌اکی‌والان به میلی‌گرم</button>
        <div class="accordion-content" id="mEqToMg">
            <!-- انتخاب ترکیب -->
            <label for="compound">ترکیب:</label>
            <select id="compound" required>
                <option value="">انتخاب کنید</option>
                <option value="74.5,1">پتاسیم کلراید (KCl)</option>
                <option value="58.5,1">سدیم کلرید (NaCl)</option>
                <option value="84,1">سدیم بی‌کربنات (NaHCO₃)</option>
                <option value="111,2">کلسیم کلرید (CaCl₂)</option>
                <option value="120,2">منیزیم سولفات (MgSO₄)</option>
                <option value="212,1">فسفات پتاسیم (K₃PO₄)</option>
                <option value="430,2">کلسیم گلوکونات (Ca(C₆H₁₁O₇)₂)</option>
            </select>
            <!-- مقدار mEq -->
            <label for="mEq">مقدار میلی‌اکی‌والان (mEq):</label>
            <input type="number" id="mEq" step="0.01" required placeholder="مقدار mEq را وارد کنید">
            <button onclick="calculateMgFromMEq()">محاسبه</button>
            <div class="result" id="mEqToMgResult"></div>
            <!-- بخش اشتراک‌گذاری -->
            <div class="share-icons hidden" id="mEqToMgShareIcons">
                <a href="#" class="whatsapp" onclick="shareOnWhatsApp()"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="instagram" onclick="shareOnInstagram()"><i class="fab fa-instagram"></i></a>
                <a href="#" class="telegram" onclick="shareOnTelegram()"><i class="fab fa-telegram"></i></a>
                <a href="#" class="twitter" onclick="shareOnTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="sms" onclick="shareViaSMS()"><i class="fas fa-sms"></i></a>
            </div>
        </div>
        <!-- بخش پرستار پلاس -->
        <div class="nurse-plus-section">
            <p>همین حالا با اپلیکیشن پرستار پلاس استخدام شو!</p>
            <a href="http://cafebazaar.ir/app/?id=app.nurse.plus&ref=share" target="_blank">
                <button>Install</button>
            </a>
        </div>

    </div>
    <!-- نویسنده کد و ساعت و تاریخ -->
   <footer>
    <div>Code by: Tavakol</div>
    <div style="display: flex; justify-content: center; gap: 15px; margin: 10px 0;">
        <a href="https://wa.me/989905415680" target="_blank" style="color: #25D366; text-decoration: none;">
            <i class="fab fa-whatsapp"></i> WhatsApp
        </a>
        <a href="https://instagram.com/_MedMate" target="_blank" style="color: #E4405F; text-decoration: none;">
            <i class="fab fa-instagram"></i> Instagram
        </a>
            
    </div>
    <div class="footer-info" id="datetime"></div>
</footer>

    <script>
        // تابع تغییر تم
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-theme');
            const themeToggle = document.getElementById('themeToggle');
            if (body.classList.contains('light-theme')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        // تابع برای باز و بسته کردن کشوها
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            content.classList.toggle('show');
        }
        // تابع برای نمایش یا مخفی کردن باکس وزن
        function toggleWeightInput() {
            const prescribedDoseUnit = document.getElementById('prescribedDoseUnit').value;
            const weightInput = document.getElementById('weightInput');
            if (prescribedDoseUnit === 'mcg/kg/min') {
                weightInput.classList.remove('hidden');
            } else {
                weightInput.classList.add('hidden');
            }
        }
        // تابع محاسبه دارو
        function calculateDrug() {
            const drugDose = parseFloat(document.getElementById('drugDose').value);
            const drugDoseUnit = document.getElementById('drugDoseUnit').value;
            const syringeVolume = parseFloat(document.getElementById('syringeVolume').value);
            const prescribedDose = parseFloat(document.getElementById('prescribedDose').value);
            const prescribedDoseUnit = document.getElementById('prescribedDoseUnit').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const infusionMethod = document.querySelector('input[name="infusionMethod"]:checked').value;

            // بررسی مقادیر ورودی
            if (isNaN(drugDose) || isNaN(syringeVolume) || isNaN(prescribedDose)) {
                document.getElementById('drugResult').innerText = "لطفاً تمام مقادیر را به درستی وارد کنید.";
                return;
            }

            // تبدیل واحد دوز دارو به میلی‌گرم یا واحد (U)
            let drugDoseMgOrU = drugDose;
            if (drugDoseUnit === 'mcg') {
                drugDoseMgOrU = drugDose / 1000; // تبدیل میکروگرم به میلی‌گرم
            }

            // محاسبه دوز تجویزی بر حسب میلی‌گرم بر ساعت یا واحد بر ساعت (U/h)
            let prescribedDoseMgOrUPerHour;
            switch (prescribedDoseUnit) {
                case 'mcg/kg/min':
                    if (isNaN(weight)) {
                        document.getElementById('drugResult').innerText = "لطفاً وزن بیمار را وارد کنید.";
                        return;
                    }
                    prescribedDoseMgOrUPerHour = (prescribedDose * weight * 60) / 1000; // تبدیل به میلی‌گرم بر ساعت
                    break;
                case 'mg/h':
                    prescribedDoseMgOrUPerHour = prescribedDose;
                    break;
                case 'mg/min': // حالت جدید اضافه شده
                    prescribedDoseMgOrUPerHour = prescribedDose * 60; // تبدیل به میلی‌گرم بر ساعت
                    break;
                case 'mcg/min':
                    prescribedDoseMgOrUPerHour = (prescribedDose * 60) / 1000; // تبدیل به میلی‌گرم بر ساعت
                    break;
                case 'mcg/h':
                    prescribedDoseMgOrUPerHour = prescribedDose / 1000; // تبدیل میکروگرم بر ساعت به میلی‌گرم بر ساعت
                    break;
                case 'U/h':
                    prescribedDoseMgOrUPerHour = prescribedDose; // واحد بر ساعت (U/h)
                    break;
                default:
                    document.getElementById('drugResult').innerText = "واحد دوز تجویزی نامعتبر است.";
                    return;
            }

            // محاسبه نرخ تزریق
            let resultText;
            if (infusionMethod === 'pump') {
                // محاسبه نرخ تزریق بر حسب cc/h
                const infusionRate = (prescribedDoseMgOrUPerHour / drugDoseMgOrU) * syringeVolume;
                resultText = `نرخ تزریق: ${infusionRate.toFixed(2)} cc/h (روش تزریق: پمپ)`;
            } else {
                // محاسبه نرخ تزریق بر حسب gtt/min
                const infusionRate = (prescribedDoseMgOrUPerHour / drugDoseMgOrU) * syringeVolume;
                resultText = `نرخ تزریق: ${infusionRate.toFixed(2)} gtt/min (روش تزریق: میکروست)`;
            }

            // نمایش نتیجه
            document.getElementById('drugResult').innerText = resultText;
            document.getElementById('drugResult').classList.add('show');
            // نمایش ایکون‌های اشتراک‌گذاری
            document.getElementById('drugShareIcons').classList.remove('hidden');
            // ذخیره نتیجه برای اشتراک‌گذاری
            window.lastCalculationResult = resultText;
        }
        // تابع محاسبه داروهای درصدی
        function calculatePercentageDrug() {
            const drugPercentage = parseFloat(document.getElementById('drugPercentage').value);
            const requiredDose = parseFloat(document.getElementById('requiredDose').value);
            // بررسی مقادیر ورودی
            if (isNaN(drugPercentage) || isNaN(requiredDose)) {
                document.getElementById('percentageDrugResult').innerText = "لطفاً تمام مقادیر را به درستی وارد کنید.";
                return;
            }
            // محاسبه سی‌سی مورد نیاز
            const ccNeeded = (requiredDose / (drugPercentage * 10)).toFixed(2);
            // نمایش نتیجه
            const resultText = `سی‌سی مورد نیاز: ${ccNeeded} سی‌سی`;
            document.getElementById('percentageDrugResult').innerText = resultText;
            document.getElementById('percentageDrugResult').classList.add('show');
            // نمایش ایکون‌های اشتراک‌گذاری
            document.getElementById('percentageDrugShareIcons').classList.remove('hidden');
            // ذخیره نتیجه برای اشتراک‌گذاری
            window.lastCalculationResult = resultText;
        }
        // تابع محاسبه سرم
        function calculateFluid() {
            const fluidVolume = parseFloat(document.getElementById('fluidVolume').value);
            const infusionTime = parseFloat(document.getElementById('infusionTime').value);
            const dripSet = parseFloat(document.getElementById('dripSet').value);
            if (isNaN(fluidVolume) || isNaN(infusionTime)) {
                document.getElementById('fluidResult').innerText = "لطفاً حجم سرم و زمان تزریق را وارد کنید.";
                return;
            }
            // محاسبه تعداد قطرات بر دقیقه
            const dropsPerMinute = (fluidVolume * dripSet) / (infusionTime * 60);
            const resultText = `تعداد قطرات بر دقیقه: ${dropsPerMinute.toFixed(2)}`;
            document.getElementById('fluidResult').innerText = resultText;
            document.getElementById('fluidResult').classList.add('show');
            // ذخیره نتیجه برای اشتراک‌گذاری
            window.lastCalculationResult = resultText;
            // نمایش ایکون‌های اشتراک‌گذاری
            document.getElementById('fluidShareIcons').classList.remove('hidden');
        }
        // تابع محاسبه میکروست
        function calculateMicroset() {
            const microsetVolume = parseFloat(document.getElementById('microsetVolume').value);
            const microsetInfusionTime = parseFloat(document.getElementById('microsetInfusionTime').value);
            if (isNaN(microsetVolume) || isNaN(microsetInfusionTime)) {
                document.getElementById('microsetResult').innerText = "لطفاً حجم میکروست و زمان تزریق را وارد کنید.";
                return;
            }
            // محاسبه تعداد قطرات بر دقیقه
            const dropsPerMinute = (microsetVolume * 60) / (microsetInfusionTime * 60);
            const resultText = `تعداد قطرات بر دقیقه: ${dropsPerMinute.toFixed(2)}`;
            document.getElementById('microsetResult').innerText = resultText;
            document.getElementById('microsetResult').classList.add('show');
            // ذخیره نتیجه برای اشتراک‌گذاری
            window.lastCalculationResult = resultText;
            // نمایش ایکون‌های اشتراک‌گذاری
            document.getElementById('microsetShareIcons').classList.remove('hidden');
        }
        // تابع محاسبه واحدهای انسولین برای اطفال
        function calculatePediatricDrug() {
            const volumeCC = parseFloat(document.getElementById('volumeCC').value);
            // بررسی مقدار ورودی
            if (isNaN(volumeCC)) {
                document.getElementById('pediatricDrugResult').innerText = "لطفاً حجم را به درستی وارد کنید.";
                return;
            }
            // محاسبه واحدهای انسولین (هر ۰.۰۲ سی‌سی = ۱ واحد انسولین)
            const insulinUnits = (volumeCC / 0.02);
            const resultText = `واحدهای انسولین: ${insulinUnits.toFixed(2)}`;
            document.getElementById('pediatricDrugResult').innerText = resultText;
            document.getElementById('pediatricDrugResult').classList.add('show');
            // ذخیره نتیجه برای اشتراک‌گذاری
            window.lastCalculationResult = resultText;
            // نمایش ایکون‌های اشتراک‌گذاری
            document.getElementById('pediatricShareIcons').classList.remove('hidden');
        }
        // تابع محاسبه میلی‌اکی‌والان به میلی‌گرم
        function calculateMgFromMEq() {
            const compound = document.getElementById('compound').value;
            const mEq = parseFloat(document.getElementById('mEq').value);

            if (!compound || isNaN(mEq)) {
                document.getElementById('mEqToMgResult').innerText = "لطفاً ترکیب و مقدار mEq را به درستی وارد کنید.";
                return;
            }

            const [molarMass, valence] = compound.split(',').map(Number);
            const mg = mEq * (molarMass / valence);

            const resultText = `${mEq} mEq معادل است با ${mg.toFixed(2)} mg`;
            document.getElementById('mEqToMgResult').innerText = resultText;
            document.getElementById('mEqToMgResult').classList.add('show');
            // نمایش ایکون‌های اشتراک‌گذاری
            document.getElementById('mEqToMgShareIcons').classList.remove('hidden');
            // ذخیره نتیجه برای اشتراک‌گذاری
            window.lastCalculationResult = resultText;
        }
        // توابع اشتراک‌گذاری
        function shareOnWhatsApp() {
            const result = window.lastCalculationResult || "نتیجه‌ای برای اشتراک‌گذاری وجود ندارد.";
            const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(result)}`;
            window.open(url, '_blank');
        }
        function shareOnInstagram() {
            const result = window.lastCalculationResult || "نتیجه‌ای برای اشتراک‌گذاری وجود ندارد.";
            const url = `https://www.instagram.com/direct/new/?text=${encodeURIComponent(result)}`;
            window.open(url, '_blank');
        }
        function shareOnTelegram() {
            const result = window.lastCalculationResult || "نتیجه‌ای برای اشتراک‌گذاری وجود ندارد.";
            const url = `https://telegram.me/share/url?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(result)}`;
            window.open(url, '_blank');
        }
        function shareOnTwitter() {
            const result = window.lastCalculationResult || "نتیجه‌ای برای اشتراک‌گذاری وجود ندارد.";
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(result)}`;
            window.open(url, '_blank');
        }
        function shareViaSMS() {
            const result = window.lastCalculationResult || "نتیجه‌ای برای اشتراک‌گذاری وجود ندارد.";
            const url = `sms:?body=${encodeURIComponent(result)}`;
            window.location.href = url;
        }
        // تابع نمایش ساعت و تاریخ
        function updateDateTime() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const datetime = now.toLocaleDateString('fa-IR', options);
            document.getElementById('datetime').innerText = datetime;
        }
        // به‌روزرسانی ساعت و تاریخ هر ثانیه
        setInterval(updateDateTime, 1000);
        updateDateTime(); // فراخوانی اولیه
        // تابع افزودن به صفحه اصلی
        function addToHomeScreen() {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                alert('اپلیکیشن شما قبلاً نصب شده است.');
                return;
            }
            if (window.deferredPrompt) {
                window.deferredPrompt.prompt();
                window.deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                    } else {
                        console.log('User dismissed the A2HS prompt');
                    }
                    window.deferredPrompt = null;
                });
            } else {
                alert('مرورگر شما از این قابلیت پشتیبانی نمی‌کند. برای نصب از مرورگر کروم استفاده کنید.'); // تغییر پیام خطا
            }
        }
        // رویداد beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (event) => {
            event.preventDefault();
            window.deferredPrompt = event;
            document.getElementById('addToHomeScreen').style.display = 'block';
        });

if ('serviceWorker' in navigator) {
  // ثبت سرویس ورکر بدون ریلود خودکار
  navigator.serviceWorker.register('/sw.js').then(reg => {
    // فقط هنگام وجود آپدیت، ریلود کن
    reg.addEventListener('updatefound', () => {
      const newWorker = reg.installing;
      newWorker.addEventListener('statechange', () => {
        if (newWorker.state === 'activated') {
          if (confirm('نسخه جدید آماده است! می‌خواهید صفحه رفرش شود؟')) {
            window.location.reload();
          }
        }
      });
    });
  });
}
    </script>
</body>
</html>
